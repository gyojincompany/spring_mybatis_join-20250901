<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.gyojincompany.mybatis.dao.OrderDao">
	
	<!-- 모든 주문 리스트 가져오기 -->
	<select id="orderListDao" resultType="com.gyojincompany.mybatis.dto.OrderDto">
		SELECT * FROM springdb.order
	</select>
	
	<!-- 모든 회원 리스트 가져오기 -->
	<select id="userListDao" resultType="com.gyojincompany.mybatis.dto.UserDto">
		SELECT * FROM springdb.user
	</select>
	
	<!-- 특정 아이디 유저 가져오기 -->
	<select id="userSearchDao" resultType="com.gyojincompany.mybatis.dto.UserDto" >
		SELECT * FROM springdb.user WHERE userid = #{param1}	
	</select>
	
	<!-- 특정 유저 아이디로 유저 세부 정보 가져오기 -->
	<select id="userInfoDao" resultType="com.gyojincompany.mybatis.dto.UserIdInfoDto">
		SELECT u.userid, u.username, i.useraddress, i.userphone
			FROM springdb.user u
				INNER JOIN springdb.userinfo i ON u.userid = i.userid
					WHERE u.userid = #{param1}
	</select>
	
	<!-- user:userinfo 1:1관계 매핑 -->
	<resultMap type="com.gyojincompany.mybatis.dto.UserDto" id="userWithUserInfo">
		<id property="userid" column="userid" /> <!-- user 테이블의 기본키 셋팅 -->
		<result property="username"  column="username" /> <!-- user 테이블의 나머지 필드 셋팅 -->
		
		<association property="userInfo" javaType="com.gyojincompany.mybatis.dto.UserInfoDto">
			<id property="userid" column="userid" />
			<result property="useraddress" column="useraddress" />
			<result property="userphone" column="userphone" />
		</association>
	</resultMap>
	
	<!-- 특정 유저 아이디로 유저 세부 정보 가져오기 -->
	<select id="userInfoMapDao" resultMap="userWithUserInfo">
		SELECT u.userid, u.username, i.useraddress, i.userphone
			FROM springdb.user u
				INNER JOIN springdb.userinfo i ON u.userid = i.userid
					WHERE u.userid = #{param1}
	</select>
	
	<!-- user:order 1:N관계 매핑 -->
	<resultMap type="com.gyojincompany.mybatis.dto.UserDto" id="userWithOrder">
		<id property="userid" column="userid" /> <!-- user 테이블의 기본키 셋팅 -->
		<result property="username"  column="username" /> <!-- user 테이블의 나머지 필드 셋팅 -->
		
		<!-- order List 매핑 -->
		<collection property="orderDtos" ofType="com.gyojincompany.mybatis.dto.OrderDto">
			<id property="orderid" column="orderid" /> <!-- order 테이블의 기본키 셋팅 -->
			<result property="ordername" column="ordername" /> <!-- order 테이블의 나머지 필드 셋팅 -->
			<result property="userid" column="userid" /> <!-- order 테이블의 나머지 필드 셋팅 -->
		</collection>
	</resultMap>
	
	<select id="userOrderListDao" resultMap="userWithOrder">
		SELECT u.userid, u.username, o.orderid, o.ordername 
			FROM springdb.user u
				INNER JOIN springdb.order o ON u.userid = o.userid
					WHERE u.userid = #{param1} 
	</select>
	
	<select id="AllUserOrderLitsDao" resultMap="userWithOrder">
		SELECT u.userid, u.username, o.orderid, o.ordername 
			FROM springdb.user u
				INNER JOIN springdb.order o ON u.userid = o.userid							
	</select>
		
</mapper>    
    